var TrafficMessage={allMessagesArray:[],roadTrafficArray:[],publicTransportArray:[],plannedInterferenceArray:[],otherArray:[],markers:[],infoWindow:void 0,prev_InfoWindow:!1,chosenCategory:"4",init:function(){TrafficMessage.getMessages(),TrafficMessage.getChosenCategoryClick(),TrafficMessage.getMessageListClick()},getMessages:function(){$.ajax({type:"GET",url:"calls/TrafficMessageCall.php",success:function(a){a=JSON.parse(a);var b=a.messages.reverse();b=TrafficMessage.filterUnique(b);for(var c=0;100>c;c++)0==b[c].category&&TrafficMessage.roadTrafficArray.push(b[c]),1==b[c].category&&TrafficMessage.publicTransportArray.push(b[c]),2==b[c].category&&TrafficMessage.plannedInterferenceArray.push(b[c]),3==b[c].category&&TrafficMessage.otherArray.push(b[c]),TrafficMessage.allMessagesArray.push(b[c]);TrafficMessage.getChosenCategoryMessages()}})},filterUnique:function(a){var b={};return a.filter(function(a){return b.hasOwnProperty(a.id)?!1:b[a.id]=!0})},renderTitle:function(a,b){var c=document.getElementById("messageList"),d=document.createElement("a"),e=document.createElement("li");d.textContent=a,d.href="#"+b,d.id=b,e.appendChild(d),c.appendChild(e)},renderInfoWindow:function(a,b,c,d){c=new Date(parseInt(c.replace("/Date(","").replace(")/",""),10));var e='<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+b+"</h1>"+'<div id="bodyContent">'+"<p>"+c+"</p>"+"<p>"+a+"</p>"+"<p>"+d+"</p>"+"</div>"+"</div>";this.infoWindow=new google.maps.InfoWindow({content:e})},getMessageListClick:function(){$("#messageList").on("click",function(a){for(var b=0;b<TrafficMessage.markers.length;b++)TrafficMessage.markers[b].id==a.target.id&&(TrafficMessage.prev_InfoWindow&&TrafficMessage.prev_InfoWindow.close(),TrafficMessage.renderInfoWindow(TrafficMessage.markers[b].description,TrafficMessage.markers[b].title,TrafficMessage.markers[b].date,TrafficMessage.markers[b].subcategory),TrafficMessage.prev_InfoWindow=TrafficMessage.infoWindow,TrafficMessage.infoWindow.open(GoogleMap.map,TrafficMessage.markers[b]))})},getChosenCategoryClick:function(){$("#selectList").change(function(a){TrafficMessage.chosenCategory=a.target.value,TrafficMessage.getChosenCategoryMessages()})},getChosenCategoryMessages:function(){TrafficMessage.resetMarkers();for(var a=0;a<TrafficMessage.allMessagesArray.length;a++){switch(TrafficMessage.chosenCategory){case"0":var b=new google.maps.Marker({map:GoogleMap.map,position:new google.maps.LatLng(TrafficMessage.roadTrafficArray[a].latitude,TrafficMessage.roadTrafficArray[a].longitude),title:TrafficMessage.roadTrafficArray[a].title,date:TrafficMessage.roadTrafficArray[a].createddate,description:TrafficMessage.roadTrafficArray[a].description,id:TrafficMessage.roadTrafficArray[a].id,subcategory:TrafficMessage.roadTrafficArray[a].subcategory});TrafficMessage.markers.push(b),TrafficMessage.renderTitle(TrafficMessage.markers[a].title,TrafficMessage.markers[a].id);break;case"1":var b=new google.maps.Marker({map:GoogleMap.map,position:new google.maps.LatLng(TrafficMessage.publicTransportArray[a].latitude,TrafficMessage.publicTransportArray[a].longitude),title:TrafficMessage.publicTransportArray[a].title,date:TrafficMessage.publicTransportArray[a].createddate,description:TrafficMessage.publicTransportArray[a].description,id:TrafficMessage.publicTransportArray[a].id,subcategory:TrafficMessage.publicTransportArray[a].subcategory});TrafficMessage.markers.push(b),TrafficMessage.renderTitle(TrafficMessage.markers[a].title,TrafficMessage.markers[a].id);break;case"2":var b=new google.maps.Marker({map:GoogleMap.map,position:new google.maps.LatLng(TrafficMessage.plannedInterferenceArray[a].latitude,TrafficMessage.plannedInterferenceArray[a].longitude),title:TrafficMessage.plannedInterferenceArray[a].title,date:TrafficMessage.plannedInterferenceArray[a].createddate,description:TrafficMessage.plannedInterferenceArray[a].description,id:TrafficMessage.plannedInterferenceArray[a].id,subcategory:TrafficMessage.plannedInterferenceArray[a].subcategory});TrafficMessage.markers.push(b),TrafficMessage.renderTitle(TrafficMessage.markers[a].title,TrafficMessage.markers[a].id);break;case"3":var b=new google.maps.Marker({map:GoogleMap.map,position:new google.maps.LatLng(TrafficMessage.otherArray[a].latitude,TrafficMessage.otherArray[a].longitude),title:TrafficMessage.otherArray[a].title,date:TrafficMessage.otherArray[a].createddate,description:TrafficMessage.otherArray[a].description,id:TrafficMessage.otherArray[a].id,subcategory:TrafficMessage.otherArray[a].subcategory});TrafficMessage.markers.push(b),TrafficMessage.renderTitle(TrafficMessage.markers[a].title,TrafficMessage.markers[a].id);break;case"4":var b=new google.maps.Marker({map:GoogleMap.map,position:new google.maps.LatLng(TrafficMessage.allMessagesArray[a].latitude,TrafficMessage.allMessagesArray[a].longitude),title:TrafficMessage.allMessagesArray[a].title,date:TrafficMessage.allMessagesArray[a].createddate,description:TrafficMessage.allMessagesArray[a].description,id:TrafficMessage.allMessagesArray[a].id,subcategory:TrafficMessage.allMessagesArray[a].subcategory});TrafficMessage.markers.push(b),TrafficMessage.renderTitle(TrafficMessage.markers[a].title,TrafficMessage.markers[a].id)}google.maps.event.addListener(b,"click",function(b){var c=TrafficMessage.markers[a].description,d=TrafficMessage.markers[a].date,e=TrafficMessage.markers[a].title,f=TrafficMessage.markers[a].subcategory;return function(){TrafficMessage.prev_InfoWindow&&TrafficMessage.prev_InfoWindow.close(),TrafficMessage.renderInfoWindow(c,e,d,f),TrafficMessage.prev_InfoWindow=TrafficMessage.infoWindow,TrafficMessage.infoWindow.open(GoogleMap.map,b)}}(b))}},resetMarkers:function(){for(var a=0;a<TrafficMessage.markers.length;a++)TrafficMessage.markers[a].setMap(null);TrafficMessage.markers=[],document.getElementById("messageList").innerHTML=""}};window.addEventListener("load",TrafficMessage.init);